# 07-domain-service-location.md
> ë„ë©”ì¸ ì„œë¹„ìŠ¤ ìœ„ì¹˜ ê²°ì • ì›ì¹™

---

## ğŸ¯ ê°œìš”

ë³¸ ë¬¸ì„œëŠ” DDDì—ì„œ ë„ë©”ì¸ ì„œë¹„ìŠ¤ì˜ ìœ„ì¹˜ë¥¼ ê²°ì •í•˜ëŠ” ì›ì¹™ê³¼ í˜„ì¬ í”„ë¡œì íŠ¸ì˜ ì ìš© ë°©ì•ˆì„ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ë„ë©”ì¸ ì„œë¹„ìŠ¤ ìœ„ì¹˜ ê²°ì • ì›ì¹™

### 1. ë‹¨ì¼ Aggregateì— ì†í•˜ëŠ” ë„ë©”ì¸ ì„œë¹„ìŠ¤

**ì›ì¹™**: í•´ë‹¹ Aggregateì˜ íŒ¨í‚¤ì§€ì— ìœ„ì¹˜

**ì˜ˆì‹œ**:
```
domain/
â””â”€â”€ user/
    â”œâ”€â”€ User.java
    â”œâ”€â”€ UserRepository.java
    â””â”€â”€ UserValidationService.java  # User Aggregateë§Œ ê²€ì¦
```

**íŠ¹ì§•**:
- í•˜ë‚˜ì˜ Aggregate ë‚´ë¶€ ë¡œì§ë§Œ ì²˜ë¦¬
- ë‹¤ë¥¸ Aggregateë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠìŒ

---

### 2. ì—¬ëŸ¬ Aggregateë¥¼ ì¡°í•©í•˜ëŠ” ë„ë©”ì¸ ì„œë¹„ìŠ¤

**ì›ì¹™**: ê°€ì¥ ê´€ë ¨ì´ ê¹Šì€ Aggregateì˜ íŒ¨í‚¤ì§€ì— ìœ„ì¹˜

**íŒë‹¨ ê¸°ì¤€**:
1. **ê²°ê³¼ë¬¼(Output)ì´ ì–´ëŠ Aggregateì— ì†í•˜ëŠ”ê°€?**
2. **ì£¼ìš” ì±…ì„ì´ ì–´ëŠ Aggregateì— ìˆëŠ”ê°€?**
3. **ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ì ì—ì„œ ì–´ëŠ Aggregateì˜ ê°œë…ì¸ê°€?**

**ì˜ˆì‹œ 1: ê²°ê³¼ë¬¼ ê¸°ì¤€**
```
domain/
â””â”€â”€ product/
    â”œâ”€â”€ Product.java
    â”œâ”€â”€ ProductDetail.java          # ê²°ê³¼ë¬¼ (Value Object)
    â””â”€â”€ ProductDetailService.java   # ProductDetailì„ ìƒì„±í•˜ë¯€ë¡œ product íŒ¨í‚¤ì§€
```

**ì˜ˆì‹œ 2: ì£¼ìš” ì±…ì„ ê¸°ì¤€**
```
domain/
â””â”€â”€ order/
    â”œâ”€â”€ Order.java
    â””â”€â”€ OrderService.java          # Order, User, Productë¥¼ ì¡°í•©í•˜ì§€ë§Œ
                                    # ì£¼ë¬¸ ì™„ë£Œ/ì·¨ì†Œê°€ ì£¼ìš” ì±…ì„ì´ë¯€ë¡œ order íŒ¨í‚¤ì§€
```

---

### 3. ê³µìœ  ë„ë©”ì¸ ì„œë¹„ìŠ¤ (Shared Domain Service)

**ì›ì¹™**: ë³„ë„ì˜ ê³µìœ  íŒ¨í‚¤ì§€ì— ìœ„ì¹˜

**ì‚¬ìš© ì‹œê¸°**:
- ì—¬ëŸ¬ Aggregateì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë„ë©”ì¸ ë¡œì§
- íŠ¹ì • Aggregateì— ì†í•˜ì§€ ì•ŠëŠ” ë²”ìš© ë„ë©”ì¸ ë¡œì§
- ë„ë©”ì¸ ê°„ í˜‘ë ¥ì´ ë³µì¡í•˜ê³  ê· í˜• ì¡íŒ ê²½ìš°

**ì˜ˆì‹œ**:
```
domain/
â”œâ”€â”€ shared/
â”‚   â””â”€â”€ DiscountCalculator.java    # ì—¬ëŸ¬ Aggregateì—ì„œ ì‚¬ìš©
â”œâ”€â”€ product/
â””â”€â”€ order/
```

**ì£¼ì˜ì‚¬í•­**:
- ë‚¨ìš©í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜
- ëŒ€ë¶€ë¶„ì˜ ê²½ìš° íŠ¹ì • Aggregate íŒ¨í‚¤ì§€ì— ìœ„ì¹˜í•˜ëŠ” ê²ƒì´ ë” ë‚˜ìŒ

---

## ğŸ” í˜„ì¬ í”„ë¡œì íŠ¸ ë¶„ì„

### ProductDetailService

**í˜„ì¬ ìœ„ì¹˜**: `domain/product/ProductDetailService.java`

**ë¶„ì„**:
- **ì…ë ¥**: Product (Aggregate), Brand (Aggregate)
- **ì¶œë ¥**: ProductDetail (Value Object, product íŒ¨í‚¤ì§€ì— ìœ„ì¹˜)
- **ì£¼ìš” ì±…ì„**: ìƒí’ˆ ìƒì„¸ ì •ë³´ ì¡°í•©

**ê²°ë¡ **: âœ… **í˜„ì¬ ìœ„ì¹˜ê°€ ì ì ˆí•¨**

**ì´ìœ **:
1. ê²°ê³¼ë¬¼ì¸ `ProductDetail`ì´ `product` íŒ¨í‚¤ì§€ì— ìœ„ì¹˜
2. ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ì ì—ì„œ "ìƒí’ˆ ìƒì„¸ ì¡°íšŒ"ëŠ” Product Aggregateì˜ ì±…ì„
3. BrandëŠ” ì°¸ì¡°ë§Œ í•˜ê³ , ì£¼ìš” ë¡œì§ì€ Product ì¤‘ì‹¬

---

### OrderService

**í˜„ì¬ ìœ„ì¹˜**: `domain/order/OrderService.java`

**ë¶„ì„**:
- **ì…ë ¥**: Order, User, Product (3ê°œ Aggregate)
- **ì¶œë ¥**: Order ìƒíƒœ ë³€ê²½, User í¬ì¸íŠ¸ ë³€ê²½, Product ì¬ê³  ë³€ê²½
- **ì£¼ìš” ì±…ì„**: ì£¼ë¬¸ ì™„ë£Œ/ì·¨ì†Œ í”„ë¡œì„¸ìŠ¤

**ê²°ë¡ **: âœ… **í˜„ì¬ ìœ„ì¹˜ê°€ ì ì ˆí•¨**

**ì´ìœ **:
1. ì£¼ë¬¸ ì™„ë£Œ/ì·¨ì†ŒëŠ” Order Aggregateì˜ í•µì‹¬ ì±…ì„
2. Userì™€ ProductëŠ” í˜‘ë ¥ìì¼ ë¿, ì£¼ì²´ëŠ” Order
3. ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ì ì—ì„œ "ì£¼ë¬¸ ì²˜ë¦¬"ëŠ” Order ë„ë©”ì¸ì˜ ì±…ì„

---

## ğŸ“Š ìœ„ì¹˜ ê²°ì • ì˜ì‚¬ê²°ì • íŠ¸ë¦¬

```mermaid
flowchart TD
    A[ë„ë©”ì¸ ì„œë¹„ìŠ¤ ìœ„ì¹˜ ê²°ì •] --> B{ë‹¨ì¼ Aggregateë§Œ ë‹¤ë£¨ëŠ”ê°€?}
    B -->|Yes| C[í•´ë‹¹ Aggregate íŒ¨í‚¤ì§€ì— ìœ„ì¹˜]
    B -->|No| D{ê²°ê³¼ë¬¼ì´ ëª…í™•í•œê°€?}
    D -->|Yes| E[ê²°ê³¼ë¬¼ì´ ì†í•œ Aggregate íŒ¨í‚¤ì§€ì— ìœ„ì¹˜]
    D -->|No| F{ì£¼ìš” ì±…ì„ì´ ëª…í™•í•œê°€?}
    F -->|Yes| G[ì£¼ìš” ì±…ì„ì´ ìˆëŠ” Aggregate íŒ¨í‚¤ì§€ì— ìœ„ì¹˜]
    F -->|No| H{ì—¬ëŸ¬ Aggregateì—ì„œ ê³µí†µ ì‚¬ìš©?}
    H -->|Yes| I[ê³µìœ  íŒ¨í‚¤ì§€ì— ìœ„ì¹˜<br/>domain/shared/]
    H -->|No| J[ê°€ì¥ ê´€ë ¨ì´ ê¹Šì€ Aggregate íŒ¨í‚¤ì§€ì— ìœ„ì¹˜]
```

---

## ğŸ’¡ ì‹¤ë¬´ ê°€ì´ë“œë¼ì¸

### âœ… ê¶Œì¥ ì‚¬í•­

1. **ê²°ê³¼ë¬¼ ê¸°ì¤€ ìš°ì„ **: ì„œë¹„ìŠ¤ê°€ ìƒì„±í•˜ëŠ” ê²°ê³¼ë¬¼ì´ ì–´ë””ì— ì†í•˜ëŠ”ì§€ í™•ì¸
2. **ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ì  ê³ ë ¤**: ë„ë©”ì¸ ì „ë¬¸ê°€ê°€ ìƒê°í•˜ëŠ” "ëˆ„êµ¬ì˜ ì±…ì„ì¸ê°€?"
3. **ì¼ê´€ì„± ìœ ì§€**: í”„ë¡œì íŠ¸ ì „ì²´ì—ì„œ ë™ì¼í•œ ì›ì¹™ ì ìš©

### âš ï¸ ì£¼ì˜ ì‚¬í•­

1. **ê³µìœ  íŒ¨í‚¤ì§€ ë‚¨ìš© ê¸ˆì§€**: ëŒ€ë¶€ë¶„ì˜ ê²½ìš° íŠ¹ì • Aggregate íŒ¨í‚¤ì§€ì— ìœ„ì¹˜í•˜ëŠ” ê²ƒì´ ë” ë‚˜ìŒ
2. **ìˆœí™˜ ì°¸ì¡° ë°©ì§€**: Aggregate ê°„ ì§ì ‘ ì˜ì¡´ì€ í”¼í•˜ê³ , ID ì°¸ì¡° ì‚¬ìš©
3. **íŒ¨í‚¤ì§€ êµ¬ì¡° ë‹¨ìˆœí™”**: ë¶ˆí•„ìš”í•œ ì¤‘ì²© êµ¬ì¡°ëŠ” í”¼í•¨

---

## ğŸ”„ ëŒ€ì•ˆ ê³ ë ¤: ProductDetailService ìœ„ì¹˜

### ì˜µì…˜ 1: í˜„ì¬ ìœ„ì¹˜ ìœ ì§€ (ê¶Œì¥) âœ…

```
domain/
â””â”€â”€ product/
    â”œâ”€â”€ Product.java
    â”œâ”€â”€ ProductDetail.java
    â””â”€â”€ ProductDetailService.java
```

**ì¥ì **:
- ê²°ê³¼ë¬¼(ProductDetail)ê³¼ ê°™ì€ íŒ¨í‚¤ì§€
- ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ì ì—ì„œ "ìƒí’ˆ ìƒì„¸"ëŠ” Productì˜ ì±…ì„
- ì¼ê´€ì„± ìœ ì§€ (OrderServiceë„ order íŒ¨í‚¤ì§€ì— ìœ„ì¹˜)

**ë‹¨ì **:
- Brand Aggregateë¥¼ ì°¸ì¡°í•˜ì§€ë§Œ, ì´ëŠ” ì •ìƒì ì¸ Aggregate ê°„ í˜‘ë ¥

---

### ì˜µì…˜ 2: ê³µìœ  íŒ¨í‚¤ì§€ë¡œ ì´ë™

```
domain/
â”œâ”€â”€ shared/
â”‚   â””â”€â”€ ProductDetailService.java
â”œâ”€â”€ product/
â””â”€â”€ brand/
```

**ì¥ì **:
- Productì™€ Brandë¥¼ ë™ë“±í•˜ê²Œ ì·¨ê¸‰

**ë‹¨ì **:
- ê²°ê³¼ë¬¼(ProductDetail)ê³¼ ë¶„ë¦¬ë¨
- ê³µìœ  íŒ¨í‚¤ì§€ ë‚¨ìš©
- ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ì ì—ì„œ "ìƒí’ˆ ìƒì„¸"ëŠ” Productì˜ ì±…ì„ì´ ëª…í™•í•¨

---

### ì˜µì…˜ 3: ë³„ë„ íŒ¨í‚¤ì§€ ìƒì„±

```
domain/
â”œâ”€â”€ productdetail/
â”‚   â”œâ”€â”€ ProductDetail.java
â”‚   â””â”€â”€ ProductDetailService.java
â”œâ”€â”€ product/
â””â”€â”€ brand/
```

**ì¥ì **:
- ProductDetailì„ ë…ë¦½ì ì¸ ê°œë…ìœ¼ë¡œ ì·¨ê¸‰

**ë‹¨ì **:
- ProductDetailì€ Value Objectì¼ ë¿, ë…ë¦½ì ì¸ Aggregateê°€ ì•„ë‹˜
- ë¶ˆí•„ìš”í•œ íŒ¨í‚¤ì§€ ì¦ê°€
- Productì™€ì˜ ê´€ê³„ê°€ ì•½í•´ì§

---

## ğŸ“ ê²°ë¡ 

### ProductDetailServiceì˜ ìœ„ì¹˜

**í˜„ì¬ ìœ„ì¹˜ ìœ ì§€ ê¶Œì¥**: `domain/product/ProductDetailService.java`

**ì´ìœ **:
1. âœ… ê²°ê³¼ë¬¼ì¸ `ProductDetail`ì´ `product` íŒ¨í‚¤ì§€ì— ìœ„ì¹˜
2. âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ì ì—ì„œ "ìƒí’ˆ ìƒì„¸ ì¡°íšŒ"ëŠ” Product Aggregateì˜ ì±…ì„
3. âœ… í”„ë¡œì íŠ¸ì˜ ì¼ê´€ì„± ìœ ì§€ (OrderServiceë„ order íŒ¨í‚¤ì§€ì— ìœ„ì¹˜)
4. âœ… ì—¬ëŸ¬ Aggregateë¥¼ ì¡°í•©í•˜ë”ë¼ë„, ì£¼ìš” ì±…ì„ì´ ëª…í™•í•˜ë©´ í•´ë‹¹ Aggregate íŒ¨í‚¤ì§€ì— ìœ„ì¹˜í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì 

---

## ğŸ“ ì°¸ê³ : DDD ì›ì¹™

### Eric Evansì˜ DDD ì›ì¹™

> "ë„ë©”ì¸ ì„œë¹„ìŠ¤ëŠ” ì—¬ëŸ¬ Aggregateë¥¼ ì¡°í•©í•˜ëŠ” ë¡œì§ì„ ì²˜ë¦¬í•˜ì§€ë§Œ, 
> ì¼ë°˜ì ìœ¼ë¡œ ê°€ì¥ ê´€ë ¨ì´ ê¹Šì€ Aggregateì˜ íŒ¨í‚¤ì§€ì— ìœ„ì¹˜í•œë‹¤."

### Vaughn Vernonì˜ êµ¬í˜„ íŒ¨í„´

> "ë„ë©”ì¸ ì„œë¹„ìŠ¤ëŠ” ê²°ê³¼ë¬¼ì´ë‚˜ ì£¼ìš” ì±…ì„ì´ ìˆëŠ” Aggregateì˜ íŒ¨í‚¤ì§€ì— ìœ„ì¹˜í•œë‹¤.
> ê³µìœ  íŒ¨í‚¤ì§€ëŠ” ì •ë§ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì‚¬ìš©í•œë‹¤."

---

## ğŸ“š ì°¸ê³  ìë£Œ

- **Domain-Driven Design** (Eric Evans)
- **Implementing Domain-Driven Design** (Vaughn Vernon)
- **Domain-Driven Design Distilled** (Vaughn Vernon)


# 01-requirements.md
> 루프팩 감성 이커머스 – 요구사항 및 유스케이스 명세서  

---

## 📘 1. 개요
루프팩 이커머스는 여러 브랜드의 상품을 한 번에 주문하고, 좋아요와 포인트 결제를 통해 감성적 쇼핑 경험을 제공하는 플랫폼이다. 본 문서는 사용자 중심 시나리오 기반으로 **기능 요구사항**과 **유스케이스**를 정의하며, 이후 UML(시퀀스, 클래스, ERD)으로 확장된다.

---

## 👥 2. 주요 액터
| 액터 | 설명 |
|------|------|
| **User (사용자)** | 상품 탐색, 좋아요, 주문 등 주요 행위를 수행하는 주체 |
| **System (이커머스 시스템)** | 포인트 및 재고를 관리하고 주문 정보를 처리 |
| **External Service (외부 연동 시스템)** | 주문 정보를 전달받는 외부 서비스(Mock 처리 가능) |

---

## 🧾 3. 유스케이스 목록
| UC ID | 유스케이스명 | 주요 액터 | 설명 | 관계 |
|------|---------------|----------|------|------|
| UC-01 | 상품 목록 조회 | User | 브랜드/정렬 기준별 상품 목록을 조회한다 | - |
| UC-02 | 상품 상세 조회 | User | 특정 상품의 상세 정보를 확인한다 | includes(UC-01) |
| UC-03 | 상품 좋아요 등록/취소 | User | 상품에 좋아요를 누르거나 취소한다 | - |
| UC-04 | 주문 생성 | User | 여러 상품을 선택해 포인트로 결제하고 주문을 생성한다 | include(UC-02) |
| UC-04-1 | 포인트 결제 처리 | System | 주문 생성 중 포인트 차감을 수행한다 | include(UC-04) |
| UC-04-2 | 재고 차감 처리 | System | 주문 생성 중 상품 재고를 차감한다 | include(UC-04) |
| UC-04-3 | 외부 주문 전송 | System/External | 주문 생성 후 외부 시스템에 전송한다 | include(UC-04) |
| UC-05 | 주문 내역 조회 | User | 사용자의 주문 이력을 확인한다 | - |
| UC-06 | 단일 주문 상세 조회 | User | 특정 주문의 상세 정보를 확인한다 | include(UC-05) |

---

## 🎛️ 3-1. 유스케이스 다이어그램
<img src="./use%20case%20diagram.png" alt="유스케이스 다이어그램" />

---

## 🧩 4. 유스케이스 명세

### 🛍 UC-01 상품 목록 조회
| 구분 | 내용 |
|------|------|
| **액터** | User |
| **기본 시나리오** | 1) 사용자가 상품 목록 페이지에 접근한다.<br> 2) 정렬(latest/price_asc/likes_desc)과 필터(brandId)를 선택한다.<br> 3) 시스템은 조건에 맞는 상품 목록을 반환한다.<br> 4) 각 상품의 좋아요 수를 함께 표시한다. |
| **대안 시나리오** | 4a. 사용자가 로그인 된 경우 본인이 좋아요 했는지를 함께 표시한다.
| **예외 시나리오** | • 등록된 상품이 없는 경우 빈 배열 반환한다.<br> • 정렬 기준이 유효하지 않으면 기본(latest)으로 조회한다 |
| **후조건** | 상품 목록이 사용자 화면에 표시된다. |

---

### 📄 UC-02 상품 상세 조회
| 구분 | 내용 |
|------|------|
| **액터** | User |
| **사전조건** | • 요청 시 상품 ID가 파라미터로 전달된다.<br> • (선택) 사용자가 로그인된 상태이다.|
| **기본 시나리오** | 1) 사용자는 상품 목록이나 링크를 통해 상세 페이지에 접근할 수 있다.<br> 2) 시스템은 상품명, 가격, 재고, 좋아요 수, 브랜드 정보를 반환한다. |
| **예외 시나리오** | • 상품 ID가 존재하지 않거나 삭제된 상품 혹은 인 경우 404 반환한다. <br> • 상품이 비공개 상태일 경우 403 반환한다.<br> • 상품 ID 형식이 잘못된 경우 400 반환한다. |
| **후조건** | 상품 상세 정보가 표시된다. |

---

### ❤️ UC-03 상품 좋아요 등록/취소
| 구분 | 내용 |
|------|------|
| **액터** | User |
| **사전조건** | • 사용자는 로그인 상태이다. |
| **기본 시나리오** | 1) 사용자가 상세/목록 페이지에서 좋아요 버튼을 클릭한다.<br> 2) 시스템은 해당 사용자의 좋아요 등록/취소를 처리한다.<br> 4) 현재 상태(liked=true/false)와 총 좋아요 수를 반환한다. |
| **예외 시나리오** | • 중복 요청 시 동일 결과 반환(멱등 보장)<br> • 데이터 충돌 시 요청 재시도 처리 |
| **후조건** | 좋아요 상태가 변경되고, 상품 목록/상세 정보에 반영된다. |
| **비고** | (user_id, product_id) UNIQUE 제약으로 중복 방지 |

---

### 🛒 UC-04 주문 생성
| 구분 | 내용 |
|------|------|
| **액터** | User |
| **사전조건** | 상품이 존재하고 재고 및 포인트가 충분해야 함 |
| **기본 시나리오** | 1) 사용자가 여러 상품을 선택해 주문을 요청한다.<br> 2) OrderService는 ProductService에 재고 확인을 요청한다.<br> 3) OrderService는 PointService에 결제 금액만큼 포인트 차감을 요청한다.<br> 4) 모든 검증이 통과되면 주문 정보를 생성한다.<br> 5) 주문 정보를 외부 시스템으로 전송한다.<br> 6) 주문 생성 결과(주문번호, 결제금액, 잔여 포인트)를 반환한다. |
| **예외 시나리오** | • 포인트 부족 → “결제 실패” 응답 및 충전 안내<br> • 재고 부족 → “주문 불가 상품” 메시지 반환<br> • 외부 전송 실패 → 주문은 저장되지만 상태를 “보류(PENDING)”로 표시 |
| **후조건** | 포인트와 재고가 차감되고, 주문 내역이 생성된다. |
| **비고** | UC-04-1~3을 포함하며, 트랜잭션으로 처리해야 함. |

#### UC-04-1 포인트 결제 처리
| 항목 | 내용 |
|------|------|
| **액터** | System |
| **기능 요약** | 사용자의 포인트 잔액을 검증 후 주문 금액만큼 차감한다. |
| **예외 시나리오** | 잔액 부족 시 “Insufficient Points” 오류 반환 |
| **후조건** | 사용자의 포인트 잔액이 감소한다. |

#### UC-04-2 재고 차감 처리
| 항목 | 내용 |
|------|------|
| **액터** | System |
| **기능 요약** | 주문한 각 상품의 재고를 차감한다. |
| **예외 시나리오** | 재고 부족 시 해당 상품 주문 불가 처리 |
| **후조건** | 재고 수량이 감소한다. |

#### UC-04-3 외부 주문 전송
| 항목 | 내용 |
|------|------|
| **액터** | System / External Service |
| **기능 요약** | 생성된 주문을 외부 시스템으로 전송한다. |
| **예외 시나리오** | 외부 API 응답 지연 시 재시도 또는 비동기 큐에 저장 |
| **후조건** | 주문 상태가 “전송 완료”로 변경된다. |

---

### 📦 UC-05 주문 내역 조회
| 구분 | 내용 |
|------|------|
| **액터** | User |
| **사전조건** | 주문 내역이 존재 |
| **기본 시나리오** | 1) 사용자가 주문 내역 페이지를 연다.<br> 2) 시스템은 유저의 모든 주문 목록을 반환한다. |
| **예외 시나리오** | • 주문 내역이 없을 경우 빈 배열 반환 |
| **후조건** | 주문 목록이 화면에 표시된다. |

---

#### UC-06 단일 주문 상세 조회
| 구분 | 내용 |
|------|------|
| **액터** | User |
| **사전조건** | 주문이 존재하고 해당 사용자의 주문이어야 함 |
| **기본 시나리오** | 1) 사용자는 목록이나 링크를 통해 상세 페이지에 접근할 수 있다.<br> 2) 시스템은 해당 주문의 상세 정보(주문번호, 상품 목록, 총액, 상태 등)를 반환한다. |
| **예외 시나리오** | • 주문이 존재하지 않을 경우 404 반환<br> • 다른 사용자의 주문을 조회하려는 경우 403 반환<br> • 주문 ID 형식이 잘못된 경우 400 반환 |
| **후조건** | 주문 상세 정보가 화면에 표시된다. |

---

## ⚙️ 5. 비기능 요구사항
| 항목 | 내용 |
|------|------|
| **식별 방식** | 모든 API는 `X-USER-ID` 헤더로 사용자 식별 |
| **동시성 제어** | 포인트 차감 및 재고 차감은 트랜잭션 단위로 동작 |
| **멱등성 보장** | 좋아요, 주문 요청은 멱등하게 처리되어야 함 |
| **성능 요구사항** | 상품 목록 조회는 페이지네이션(page/size) 적용 |
| **확장성 고려** | 좋아요 데이터를 추천/랭킹 기능으로 확장 가능 |
| **일관성 보장** | 외부 시스템 연동 실패 시 재시도 로직 또는 보류 상태 유지 |
